var ShoppingApp=angular.module("ShoppingApp",["ngRoute"]);ShoppingApp.config(["$routeProvider",function(e){e.when("/signup/",{templateUrl:"views/signup.html"}).when("/login/",{templateUrl:"views/login.html"}).when("/:id/dashboard/seller/",{templateUrl:"views/merchant-dashboard.html"}).when("/:id/dashboard/buyer/",{templateUrl:"views/buyer-dashboard.html"}).when("/user-id=:id/edit-item/item-id=:id/",{templateUrl:"views/edit-item.html"}).when("/user-id=:id/add-item/",{templateUrl:"views/add-Product.html"}).when("/user-id=:id/buyer/id=:id/",{templateUrl:"views/detailed-product-description.html"}).when("/user-id=:id/cart/",{templateUrl:"views/buyer-cart.html"}).when("/user-id=:id/checkout/",{templateUrl:"views/buyer-checkout.html"}).otherwise({redirectTo:"/login/"})}]),ShoppingApp.controller("masterController",["$scope","$rootScope","getAbsUrl",function(e,o,t){function n(){return store.enabled?void 0:void alert('Local storage is not supported by your browser.\n Please disable "Private Mode", or upgrade to a modern browser.\n Or switch browser')}var r=t.url(),s=r.split("/");o.appBaseUrl=s[0]+"//"+s[2],o.wsBaseUrl="ws://"+s[2],n();var a=store.get("user");o.user=a?a:{};var i=store.get("userLoggedIn");e.userLoggedIn=i?!0:!1;var c=store.get("cartIsEmpty");e.cartIsEmpty=c?!0:!1,e.$on("cart-count",function(e){console.log("cart-count --> app.js",e),t.reload()}),e.logout=function(){o.user={},e.userLoggedIn=!1,store.clear(),t.navigateTo("/login/")},e.gotoCart=function(){t.navigateTo("/user-id="+o.user.username+"/cart/")},o.authenticated=function(t){e.user=t,console.log("user : ",t),e.userLoggedIn=!0,store.set("user",o.user),store.set("userLoggedIn",!0)}}]),ShoppingApp.directive("validate-email",function(){var e=/[a-zA-Z0-9._-]+@\w[a-zA-Z0-9_]+(\.\w[a-z0-9.])/g;return{require:"ngModel",restrict:"",link:function(o,t,n,r){r&&r.$validators.email&&(r.$validators.email=function(o){return r.$isEmpty(o)||e.test(o)})}}}),ShoppingApp.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(o,t,n){var r=e(n.fileModel),s=r.assign;t.bind("change",function(){o.$apply(function(){s(o,t[0].files[0])})})}}}]),ShoppingApp.directive("xorItemSnapshot",["getAbsUrl","dataTransfer","$rootScope",function(e,o,t){return{restrict:"E",templateUrl:"directives/html/item-snapshot.html",scope:{obj:"=obj"},link:function(n,r,s){n.edit=function(){o.set(n.obj),e.navigateTo("/user-id="+t.user.username+"/edit-item/item-id="+n.obj._id+"/")}}}}]),ShoppingApp.directive("xorProductCard",["getAbsUrl","dataTransfer","$rootScope",function(e,o,t){return{restrict:"E",templateUrl:"directives/html/product-card.html",scope:{obj:"=obj"},link:function(n,r,s){n.goToProduct=function(){o.set(n.obj),e.navigateTo("/user-id="+t.user.username+"/buyer/id="+n.obj._id+"/")}}}}]),ShoppingApp.controller("addNewItemController",["$scope","$http","getAbsUrl","$rootScope",function(e,o,t,n){console.log("in addNewItemController"),e.addItem=function(){var r=new FormData;r.append("file",e.myFile),e.product.username=n.user.username,r.append("product",JSON.stringify(e.product));var s=n.appBaseUrl+"/addProduct";o.post(s,r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){console.log("successfully added product"),t.navigateTo("/"+n.user.username+"/dashboard/"+n.user.role+"/")}).error(function(){})}}]),ShoppingApp.controller("cartController",["$scope","$rootScope","getAbsUrl","dataTransfer",function(e,o,t,n){e.username=o.user.username,e.cart=[],e.getMyCart=function(){var t=new WebSocket(o.wsBaseUrl+"/cart");t.onopen=function(){t.send(JSON.stringify({username:o.user.username}))},t.onmessage=function(o){e.cart=angular.copy(JSON.parse("{}"==o.data||"{ }"==o.data?null:o.data)),e.cartIsEmpty=e.cart=={}||null==e.cart?!0:!1,e.cartCount=e.cartIsEmpty?!0:e.cart.items.length,e.$emit("cart-count",e.cartCount),store.set("cartIsEmpty",e.cartIsEmpty),e.$apply(),n.set(e.cart),t.close()},t.onclose=function(){console.log("closing the connection")}},e.total=0,console.log("cart status : ",e.cartIsEmpty),e.getMyCart(),e.removeFromCart=function(t){console.log("removeFromCart : ",t),e.obj=t;var n=new WebSocket(o.wsBaseUrl+"/removeFromCart");n.onopen=function(){n.send(JSON.stringify({username:o.user.username,product_id:t._id}))},n.onmessage=function(o){var t=angular.copy(JSON.parse(o.data));"success"==t.result?$("#notification-removed-from-cart").modal("show"):$("#notification-removed-from-cart-failure").modal("show"),e.getMyCart(),n.close()},n.onclose=function(){console.log("closing the connection")}},e.checkout=function(){t.navigateTo("/user-id="+o.user.username+"/checkout/")}}]),ShoppingApp.controller("checkoutController",["$scope","$rootScope","getAbsUrl","dataTransfer",function(e,o,t,n){e.user=o.user,e.cart=n.get(),console.log("cart : ",e.cart),$("#transaction-comlete").modal("show"),e.doCheckout=function(){var e=new WebSocket(o.wsBaseUrl+"/checkout");e.onopen=function(){e.send(JSON.stringify({username:o.user.username}))},e.onmessage=function(e){console.log("evt.data : ",e.data)},e.onclose=function(){console.log("closing the connection")}},e.doCheckout(),e.gotoDashboard=function(){t.navigateTo("/"+o.user.username+"/dashboard/"+o.user.role+"/")}}]),c3=require("c3"),ShoppingApp.controller("merchantDashboardController",["$scope","getAbsUrl","$rootScope",function(e,o,t){console.log("c3",c3),e.user_id=t.user.username,e.getListOfProducts=function(){var o=new WebSocket(t.wsBaseUrl+"/products");o.onopen=function(){o.send(JSON.stringify({username:e.user_id}))},o.onmessage=function(t){var n=angular.copy(JSON.parse(t.data));e.items=n,console.log("products : ",e.items),e.$apply(),o.close()},o.onclose=function(){console.log("closing the connection")}},e.getListOfProducts(),e.top_sellers=top_sellers,e.yearly_revenues=yearly_revenues;c3.generate({bindto:"#top-sellers-donut",data:{columns:e.top_sellers,type:"donut"},donut:{title:"Top Selling Products"}}),c3.generate({bindto:"#yearly-sales-revenue",data:{x:"x",columns:e.yearly_revenues,type:"bar"},axis:{x:{type:"category"}}}),window.history;e.addNewItem=function(){console.log("Adding new item"),o.navigateTo("/user-id="+t.user.username+"/add-item/")},e.reload=function(){o.reload()}}]),ShoppingApp.controller("bulkUploadController",["$scope","$location","fileUpload","$rootScope",function(e,o,t,n){e.uploadFile=function(){var r=e.myFile;console.log("file is "),console.dir(r);var s=(o.absUrl().split("#"),n.appBaseUrl+"/uploadProducts");console.log("uploadUrl : ",s),t.uploadFileToUrl(r,s),$("#notification-success").modal("show")}}]),ShoppingApp.controller("buyerDashboardController",["$scope","getAbsUrl","$rootScope","dataTransfer",function(e,o,t,n){e.user_id=t.user.username,e.getRecommendedProducts=function(){var o=new WebSocket(t.wsBaseUrl+"/searchProducts");o.onopen=function(){o.send(JSON.stringify({search_string:""}))},o.onmessage=function(t){var n=angular.copy(JSON.parse(t.data));e.items=n,e.recommendations=e.items?e.items.slice(0,5):[],console.log("recommended products : ",e.items),e.$apply(),o.close()},o.onclose=function(){console.log("closing the connection")}},e.getRecommendedProducts(),console.log("recommendations ",e.recommendations),e.goToProduct=function(e){n.set(e),o.navigateTo("/user-id="+t.user.username+"/buyer/id="+e._id+"/")},e.search=function(){var o=new WebSocket(t.wsBaseUrl+"/searchProducts");o.onopen=function(){o.send(JSON.stringify({search_string:e.searchProduct}))},o.onmessage=function(t){e.searchResults=angular.copy(JSON.parse(t.data)),console.log("search products : ",e.items),e.$apply(),o.close()},o.onclose=function(){console.log("closing the connection")};var n=document.getElementById("search-results");n.style.display="block"}}]),ShoppingApp.controller("detailedProductViewController",["$scope","$rootScope","getAbsUrl","dataTransfer",function(e,o,t,n){e.obj=n.get(),e.user_id=o.user.username,console.log("get deta : ",e.obj),e.addToCart=function(){console.log(e.obj.name+" added to cart..");var t=new WebSocket(o.wsBaseUrl+"/addToCart");t.onopen=function(){t.send(JSON.stringify({username:e.user_id,product_id:e.obj._id}))},t.onmessage=function(e){var o=angular.copy(JSON.parse(e.data));t.close(),"success"==o.result?$("#notification-add-to-cart").modal("show"):$("#notification-add-to-cart-failure").modal("show")},t.onclose=function(){console.log("closing the connection")}},e.proceedToCheckout=function(){t.navigateTo("/user-id="+o.user.username+"/cart/")},e.gotoDashboard=function(){t.navigateTo("/"+o.user.username+"/dashboard/"+o.user.role+"/")}}]),ShoppingApp.controller("editItemController",["$rootScope","$scope","dataTransfer","$http","getAbsUrl",function(e,o,t,n,r){console.log("in editItemController"),o.obj=t.get(),o.updateItemInfo=function(){console.log("Edit item : ",o.obj),n.post(e.appBaseUrl+"/editProduct",o.obj,{headers:{"Content-Type":"application/json; charset=UTF-8"}}).success(function(o){r.navigateTo("/"+e.user.username+"/dashboard/"+e.user.role+"/"),console.log("successfully edited product")})}}]),ShoppingApp.controller("loginController",["$scope","$rootScope","getAbsUrl","$http",function(e,o,t,n){e.userCredentials={},e.navigate=function(){o.authenticated(e.user),console.log("Welcome ",e.user.username),path="/"+e.user.username+"/dashboard/"+e.user.role+"/",t.navigateTo(path)},e.throwLoginError=function(){e.user={},e.errorMessage="something went wrong.. \n Either is Invalid \n 1. username \n 2. password",alert(e.errorMessage)},e.submit=function(){var t=new WebSocket(o.wsBaseUrl+"/login");t.onopen=function(o){t.send(JSON.stringify(e.userCredentials))},t.onmessage=function(t){e.user=JSON.parse(t.data),o.user=e.user,e.$apply(),"valid"==e.user.login?e.navigate():e.throwLoginError()},t.onclose=function(){console.log("closing the connection")}},e.clear=function(){e.userCredentials={},e.errorMessage=null},e.signup=function(){t.navigateTo("/signup")}}]),ShoppingApp.controller("signupController",["$scope","$rootScope","getAbsUrl",function(e,o,t){e.user={},e.card_types=["VISA","Master","Maestro","Rupay"],e.user.role="buyer",e.user.card_details={},e.user.card_details.card_type="VISA",e.today={};var n=new Date;e.today.date=n.getDate()>10?n.getDate():"0"+n.getDate(),e.today.month=n.getMonth()+1>10?n.getMonth()+1:"0"+(n.getMonth()+1),e.today.year=n.getFullYear(),e.reset=function(){},e.registerUser=function(){console.log("new user registered : ",e.user);var t=new WebSocket(o.wsBaseUrl+"/signup");t.onopen=function(){t.send(JSON.stringify(e.user))},t.onmessage=function(o){e.user=JSON.parse(o.data),console.log("Congratulations..."),$("#registration-success").modal("show")},t.onclose=function(){console.log("closing the connection")}},e.navigateToLogin=function(){t.navigateTo("/login/")}}]),ShoppingApp.factory("getAbsUrl",["$location","$window",function(e,o){function t(){var o=e.absUrl().split("#")[0]+"#";return o}function n(e){var n=t(),r=n+e;o.location=r}function r(){o.location.reload()}return{url:t,navigateTo:n,reload:r}}]),ShoppingApp.factory("dataTransfer",function(){function e(e){t=e}function o(){return t}var t={};return{set:e,get:o}}),ShoppingApp.service("fileUpload",["$http","$rootScope",function(e,o){this.uploadFileToUrl=function(t,n){var r=new FormData;r.append("file",t),r.append("sender",JSON.stringify(o.user)),e.post(n,r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){}).error(function(){})}}]);